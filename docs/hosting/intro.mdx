---
sidebar_position: 1
title: Self-Hosting
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';


# Self-Hosting AdamRMS

The AdamRMS dashboard is packaged as a Docker image, which is stored in the Github Image repository. We recommend you deploy this on managed infrastructure (such as AWS or DigitalOcean), but this guide will be generic, and not make use of platform-specific tools where possible.

:::note Before you start
This guide assumes you have a good understanding of deploying web infrastructure, and it will not give specific commands,  or guidance for how to manage areas such as DNS.
:::

:::info
AdamRMS is distributed under the [GNU Affero General Public License v3.0](https://github.com/adam-rms/adam-rms/blob/main/LICENSE) and therefore is provided "AS IS".  
The documentation on this page is delivered as guidance and advice, and it is believed to be correct and working at the time of writing. Any comments are greatly appreciated, and should be [submitted as an issue.](https://github.com/adam-rms/website/issues/new?assignees=&labels=documentation&projects=&template=doc_issue.yaml&title=%5BDocs+Issue%5D+%3Ctitle%3E)
:::

## What You need

- A Domain AdamRMS will be deployed to - eg. `dash.adam-rms.com`
- [The AdamRMS docker image](https://github.com/adam-rms/adam-rms/pkgs/container/adam-rms)
- A MySQL or MariaDB Database
- S3-compatible storage
- A SendGrid account - for emails
- A Developer Google account - for Google Sign In

### Optional Features

- AWS Cloudfront credentials
- Sentry

<Tabs>
<TabItem value="docker" label="Docker Image" default>

The Docker image of AdamRMS can be found in the project's [Github package repository](https://github.com/adam-rms/adam-rms/pkgs/container/adam-rms), and you can pull it by running:

```sh
docker pull ghcr.io/adam-rms/adam-rms:latest
```


The Docker image requires a number of environment variable to be set. These variables can be found in [example.dev.env](https://raw.githubusercontent.com/adam-rms/adam-rms/main/example.dev.env), and you can copy this to a ``.env`` file, or set each varaible individually. There are a handful of development-related environment variables, which are discussed in [Contributing](/docs/v1/contributor/intro)

| Name | Service | Description | Default |
| ---- | ------- | ----------- | ------- |
| `bCMS__ROOTURL` | AdamRMS | The base URL which links are generated from. Should be set to the domain you're hosting AdamRMS at | http://localhost/admin |
| `bCMS__JWT` | AdamRMS | A random string used for JWT tokens. This should be randomly generated, using something like openSSL or https://generate-secret.vercel.app/32 | _Required, and should be unique!_ |
| `bCMS__TOS_URL` | AdamRMS | Link to Terms of Service that have to be accepted before creating an account on your deployed environment. Optional | |
| `bCMS__ERRORS` | AdamRMS | A Debug/Develpment flag, that should be set to _False_ or omitted in production environments | False |
| `bCMS__DB_HOSTNAME` | Database | See _Database_ for more information | |
| `bCMS__DB_DATABASE` | Database | | |
| `bCMS__DB_USERNAME` | Database | | |
| `bCMS__DB_PASSWORD` | Database | | |
| `bCMS__AWS_S3_BUCKET_REGION` | S3-compatible storage | See _S3 Compatible Storage_ for more information | |
| `bCMS__AWS_S3_BUCKET_NAME` | S3-compatible storage | | |
| `bCMS__AWS_SERVER_KEY` | S3-compatible storage | | |
| `bCMS__AWS_SERVER_SECRET_KEY` | S3-compatible storage | | |
| `bCMS__AWS_S3_BUCKET_ENDPOINT` | S3-compatible storage | | |
| `bCMS__AWS_S3_CDN` | S3-compatible storage | | |
| `bCMS__AWS_ACCOUNT_CLOUDFRONT_ENABLED` | AWS Cloudfront (Optional) | See _S3 Compatible Storage_ for more information | |
| `bCMS__AWS_ACCOUNT_PRIVATE_KEY` | AWS Cloudfront (Optional) | | |
| `bCMS__AWS_ACCOUNT_PRIVATE_KEY_ID` | AWS Cloudfront (Optional) | | |
| `bCMS__OAUTH__GOOGLEKEY` | Google Sign-in | See _Google_ for more information | |
| `bCMS__OAUTH__GOOGLESECRET` | Google Sign-in | | |
| `bCMS__SendGridAPIKEY` | SendGrid (Emails) | Sendgrid API Key, See _Sendgrid_ for more information | |
| `bCMS__FROM_EMAIL` | SendGrid (Emails) | Address that AdamRMS emails are sent from | |

</TabItem>

<TabItem value="database" label="Database" default>

A MySQL-compatible database is required by the docker image, and we know of success with both MySQL and MariaDB deployments. As with all projects, we recommend you follow security best practices when it comes to your database, as this will be the main store of user data. 
Database migrations are applied each time the docker image is run, and so updates will be automatically applied.  

</TabItem>

<TabItem value="s3" label="S3 Compatible Storage" default>

Images and files are stored using an [AWS S3 Bucket](https://aws.amazon.com/s3/), which can either be from Amazon, or from a service such as [Backblaze](https://www.backblaze.com/). Most of the environment variables should be provided when you set up the storage bucket.

#### BackBlaze B2

BackBlaze is a cloud storage service which provides S3-compatible object storage. 

##### Bucket Info

Set the bucket info to:
```
{"cache-control":"public, max-age=900, s-maxage=3600, stale-while-revalidate=900, stale-if-error=3600"}
```

##### Bucket CORS

You need to setup the CORS on the bucket to allow uploads

1. Download and authenticate the [AWS Cli](https://aws.amazon.com/cli/) (using your Backblaze credentials).
2. Create a file called `cors.json` file, and add the following the information:

```json
{
  "CORSRules": [
	  {
			"AllowedHeaders": [
				"*"
			],
			"AllowedMethods": [
				"POST",
				"PUT",
				"GET",
				"HEAD"
			],
			"AllowedOrigins": [
				"*"
			],
			"ExposeHeaders": [
				"etag",
				"x-bz-content-sha1",
				"x-amz-meta-qqfilename",
				"x-amz-meta-size",
				"x-amz-meta-subtype",
				"x-amz-meta-typeid",
				"authorization",
				"content-type",
				"origin",
				"x-amz-acl",
				"x-amz-content-sha256",
				"x-amz-date",
				"range",
				"Access-Control-Allow-Origin"
			],
			"MaxAgeSeconds": 86400
		}
	]
}
```
3. Run the following command to apply the policy to your new bucket:

```sh 
aws s3api put-bucket-cors --bucket=<BUCKETNAME> --endpoint-url=https://s3.eu-central-003.backblazeb2.com --cors-configuration=file://backblaze-cors.json
```

Then set the following environment variables

```
bCMS__AWS_S3_BUCKET_REGION=eu-central-003
bCMS__AWS_S3_BUCKET_NAME=<BUCKETNAME>
bCMS__AWS_SERVER_KEY=00xxxxx00
bCMS__AWS_SERVER_SECRET_KEY=K0000000000000/0000000000000
bCMS__AWS_S3_CDN=https://s3.eu-central-003.backblazeb2.com/<BUCKETNAME>
bCMS__AWS_S3_BUCKET_ENDPOINT=s3.eu-central-003.backblazeb2.com
```
#### AWS S3

To use AWS S3 you need two IAM users.

##### File S3 Bucket

Create an S3 Bucket, with the follwing Policy

```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "VisualEditor0",
      "Effect": "Allow",
      "Action": ["s3:PutObject", "s3:GetObject"],
      "Resource": "arn:aws:s3:::<BUCKETNAME>/*"
    }
  ]
}
```

- Then set the following environment variables, with information from the S3 console.

```
bCMS__AWS_S3_BUCKET_REGION=
bCMS__AWS_S3_BUCKET_NAME=
bCMS__AWS_SERVER_KEY=
bCMS__AWS_SERVER_SECRET_KEY=
bCMS__AWS_S3_CDN=
bCMS__AWS_S3_BUCKET_ENDPOINT=
```

#### [Cloudfront](https://aws.amazon.com/cloudfront/)

Using cloudfront is optional, but will improve image and file download times. Follow AWS guidance to set this up and set the following environment variables:

```
bCMS__AWS_ACCOUNT_CLOUDFRONT_ENABLED=TRUE
bCMS__AWS_ACCOUNT_PRIVATE_KEY=
bCMS__AWS_ACCOUNT_PRIVATE_KEY_ID=
```

Also note that when setting up a policy for the Cloudfront distribution, you must enable:
- Query strings - Include specified query strings response-content-disposition

</TabItem>
<TabItem value="sendgrid" label="SendGrid" default>

[Sendgrid](https://sendgrid.com/en-us) is an email provider that is used to send notifications from AdamRMS. It is required to verify accounts.

For many deployments of AdamRMS the free tier provided by Sendgrid should be sufficient.

You will need to generate a [Sendgrid API Key](https://app.sendgrid.com/settings/api_keys) and store this in the ```bCMS__SendGridAPIKEY``` environment variable. 

You must also set ```bCMS__FROM_EMAIL``` to be the email address that these emails are sent from. This should be an address that is known to Sendgrid and has had [Domain Authentication](https://docs.sendgrid.com/ui/account-and-settings/how-to-set-up-domain-authentication) set up, otherwise your emails are likely to be blocked or send to spam.

</TabItem>

<TabItem value="google" label="Google" default>

AdamRMS uses Google as an alternative authentication provider, which requires a Google Developer account to generate client secrets. 
We use the HybridAuth library, and its [Google Provider](https://hybridauth.github.io/hybridauth/userguide/IDProvider_info_Google.html) has good documentation on how to set this up.

You'll need a configured Client, and to set the following Environment Variables:

```
bCMS__OAUTH__GOOGLEKEY - The Client ID
bCMS__OAUTH__GOOGLESECRET - The Client Secret
```

</TabItem>

<TabItem value="sentry" label="Sentry" default>

[Sentry](https://sentry.io/welcome/) can be used to log errors that may occur from AdamRMS, which can often help to establish configuration and application issues. Follow the guidance on the sentry site to generate api keys, then set the following additional environment variables:

```
bCMS__SENTRYLOGIN
bCMS__SENTRYLOGINPUBLIC
```

:::info
Support for self-hosted deployments of AdamRMS is through [Github issues](https://github.com/adam-rms/adam-rms/issues/new/choose) __only__
:::
</TabItem>
</Tabs>